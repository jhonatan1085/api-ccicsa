"use strict";(self.webpackChunkpreclinic_angular=self.webpackChunkpreclinic_angular||[]).push([[784],{9784:(Et,k,c)=>{c.r(k),c.d(k,{BitacorasModule:()=>It});var p=c(6814),g=c(1303),t=c(5879);let P=(()=>{class n{static#t=this.\u0275fac=function(a){return new(a||n)};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-bitacoras"]],decls:1,vars:0,template:function(a,i){1&a&&t._UZ(0,"router-outlet")},dependencies:[g.lC]})}return n})();var l=c(6223),q=c(5313),Q=c(2181),D=c(4664),M=c(7921),w=c(7398),I=c(5485),O=c(3059),b=c(2893),Y=c(1807),G=c(2137),E=c(2220),Z=c(2939),d=c(7700),v=c(2296);function L(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",2),t.NdJ("click",function(){const o=t.CHM(e).$implicit;return t.KtG(null==o.action?null:o.action())}),t._uU(1),t.qZA()}if(2&n){const e=r.$implicit;t.Q6J("color",e.color),t.xp6(1),t.hij(" ",e.text," ")}}let $=(()=>{class n{constructor(e){this.data=e}static#t=this.\u0275fac=function(a){return new(a||n)(t.Y36(d.WI))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-alert"]],decls:6,vars:3,consts:[["mat-dialog-title",""],["mat-button","","mat-dialog-close","",3,"color","click",4,"ngFor","ngForOf"],["mat-button","","mat-dialog-close","",3,"color","click"]],template:function(a,i){1&a&&(t.TgZ(0,"h2",0),t._uU(1),t.qZA(),t.TgZ(2,"mat-dialog-content"),t._uU(3),t.qZA(),t.TgZ(4,"mat-dialog-actions"),t.YNc(5,L,2,2,"button",1),t.qZA()),2&a&&(t.xp6(1),t.Oqu(i.data.title),t.xp6(2),t.hij(" ",i.data.message,"\n"),t.xp6(2),t.Q6J("ngForOf",i.data.buttons))},dependencies:[p.sg,v.lW,d.ZT,d.uh,d.xY,d.H8]})}return n})(),z=(()=>{class n{constructor(e){this.dialog=e}alert(e){this.dialog.open($,{data:e})}static#t=this.\u0275fac=function(a){return new(a||n)(t.LFG(d.uw))};static#e=this.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var T=c(8034),U=c(1043),K=c(8525),H=c(3680),h=c(3305),j=c(2032),B=c(6381),y=c(7466);function V(n,r){if(1&n&&(t.TgZ(0,"mat-option",75),t._uU(1),t.qZA()),2&n){const e=r.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.nombre," ")}}function R(n,r){if(1&n&&(t.TgZ(0,"mat-option",75),t._uU(1),t.qZA()),2&n){const e=r.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.nombre," ")}}function W(n,r){if(1&n&&(t.TgZ(0,"mat-option",75),t._uU(1),t.qZA()),2&n){const e=r.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.nombre," ")}}function X(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"mat-option",76),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.onSetSite(o))}),t._uU(1),t.qZA()}if(2&n){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.AsE(" ",e.codigo," - ",e.nombre," ")}}function tt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",81),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,o=t.oxw();return t.KtG(o.addBrigada(i))}),t._UZ(1,"i",55),t.qZA()}}function et(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"tr")(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td")(11,"div",77)(12,"button",78),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.showSegment(o))}),t._UZ(13,"i",79),t.qZA(),t.YNc(14,tt,2,0,"button",80),t.qZA()()(),t.BQk()}if(2&n){const e=r.$implicit,a=t.oxw();t.xp6(3),t.Oqu(e.contratista.nombre),t.xp6(2),t.Oqu(e.tipo_brigada.nombre),t.xp6(2),t.Oqu(e.zona.nombre),t.xp6(2),t.Oqu(a.countTecnicos(e)),t.xp6(5),t.Q6J("ngIf",a.searchadd(e))}}function it(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"li",83),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.moveToPage(i.currentPage-2))})("keyup.enter",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.moveToPage(i.currentPage-2))}),t.TgZ(1,"a",84),t._uU(2," ... "),t.qZA()()}if(2&n){const e=t.oxw(2);t.Q6J("hidden",1===e.currentPage)}}function at(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"li",83),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.moveToPage(i.currentPage+2))})("keyup.enter",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.moveToPage(i.currentPage+2))}),t.TgZ(1,"a",84),t._uU(2," ... "),t.qZA()()}if(2&n){const e=t.oxw(2);t.Q6J("hidden",e.currentPage>=e.pageNumberArray[e.pageNumberArray.length-2]||e.totalData<e.serialNumberArray[e.serialNumberArray.length-1])}}function nt(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"li",63)(2,"a",65),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.moveToPage(o))}),t._uU(3),t.qZA()(),t.YNc(4,it,3,1,"li",82),t.YNc(5,at,3,1,"li",82),t.BQk()}if(2&n){const e=r.$implicit,a=r.index,i=t.oxw();t.xp6(1),t.ekj("active",e===i.currentPage),t.Q6J("ngClass",i.pageNumberArray[i.currentPage-2]>e&&1!==e&&i.pageNumberArray.length>6||i.pageNumberArray[i.currentPage]<e&&1!==e&&i.pageNumberArray.length>6&&i.pageNumberArray.length!==e?"hide-page-no":"show-page-no"),t.xp6(2),t.hij(" ",e," "),t.xp6(1),t.Q6J("ngIf",0===a&&i.pageNumberArray.length>6&&i.currentPage>2),t.xp6(1),t.Q6J("ngIf",a===i.pageNumberArray.length-2&&i.pageNumberArray.length>6)}}function ot(n,r){if(1&n&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.unidad_movil.placa," ")}}function rt(n,r){if(1&n&&(t.ynx(0),t.TgZ(1,"tr")(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t.YNc(5,ot,2,1,"div",85),t.qZA()(),t.BQk()),2&n){const e=r.$implicit;t.xp6(3),t.hij(" ",e.user.nombre," "),t.xp6(2),t.Q6J("ngIf",e.unidad_movil)}}function st(n,r){if(1&n&&(t.TgZ(0,"div",15)(1,"div",67)(2,"div",68)(3,"div",52)(4,"table",53)(5,"thead")(6,"tr")(7,"th"),t._uU(8,"TECNICO"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"UM"),t.qZA()()(),t.TgZ(11,"tbody"),t.YNc(12,rt,6,2,"ng-container",56),t.qZA()()()()()()),2&n){const e=t.oxw();t.xp6(12),t.Q6J("ngForOf",e.brigadaSelected.user_movil)}}function ct(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"tr")(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td")(7,"div",77)(8,"button",86),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.addBrigada(o))}),t._UZ(9,"i",87),t.qZA()()()(),t.BQk()}if(2&n){const e=r.$implicit;t.xp6(3),t.Oqu(e.zona),t.xp6(2),t.Oqu(e.tipo)}}function lt(n,r){if(1&n&&(t.TgZ(0,"mat-radio-button",88),t._uU(1),t.qZA()),2&n){const e=r.$implicit;t.Q6J("value",e.id),t.xp6(1),t.AsE("",e.name," ",e.surname," ")}}function dt(n,r){if(1&n&&(t.TgZ(0,"mat-radio-button",88),t._uU(1),t.qZA()),2&n){const e=r.$implicit;t.Q6J("value",e.id),t.xp6(1),t.AsE("",e.name," ",e.surname," ")}}function pt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",89)(1,"button",90),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onDelete())}),t._uU(2," Eliminar "),t.qZA()()}}const J=function(n){return{disabled:n}};let A=(()=>{class n{constructor(e,a,i,o,s,u,m,_,Ot,Yt,Gt){this.configService=e,this.bitacoraService=a,this.siteService=i,this.brigadasService=o,this.usuarioService=s,this._snackBar=u,this.router=m,this.activateRoute=_,this.fb=Ot,this.dialog=Yt,this.alertService=Gt,this.brigadas=[],this.showFilter=!1,this.searchDataValue="",this.lastIndex=0,this.pageSize=5,this.totalData=0,this.skip=0,this.limit=this.pageSize,this.pageIndex=0,this.serialNumberArray=[],this.currentPage=1,this.pageNumberArray=[],this.pageSelection=[],this.totalPages=0,this.brigadasGeneral=[],this.responsables_cicsa=[],this.responsables_claro=[],this.panelOpenState=!1,this.bitacora={tipo_averia:{},red:{},serv:{},resp_cicsa:{},resp_claro:{}},this.tipo_Averia=[],this.red=[],this.serv=[],this.siteControl=new l.NI,this.step=0,this.datosForm=this.fb.group({nombre:[null,l.kI.required],fecha_inicial:[null,l.kI.required],sot:[],incidencia:[],latitud:[],longitud:[],distancia:[],tipo_averia_id:[null,l.kI.required],red_id:[null,l.kI.required],serv_id:[null,l.kI.required]}),this.siteForm=this.fb.group({site_id:[null,l.kI.required],cliente:[]}),this.brigadasForm=this.fb.group({brigadas:this.fb.array([],l.kI.required)}),this.responsablesForm=this.fb.group({resp_cicsa_id:[null,l.kI.required],resp_claro_id:[null,l.kI.required]})}ngOnInit(){this.getBitacoraFromParams(),this.getConfigBitacora(),this.getSites(),this.getTableData()}getBitacoraFromParams(){this.activateRoute.params.pipe((0,Q.h)(e=>e.id),(0,D.w)(e=>this.bitacoraService.read(e.id))).subscribe(e=>{console.log(e),this.bitacora=e,this.datosForm.patchValue({...this.bitacora,tipo_averia_id:e.tipo_averia.id,red_id:e.red.id,serv_id:e.serv.id}),this.siteForm.patchValue({site_id:e.site.id,cliente:e.cliente}),this.brigadasForm.reset(),this.bitacora.brigadas.forEach(a=>{this.addBrigada(a)}),this.responsablesForm.patchValue({resp_cicsa_id:this.bitacora.resp_cicsa.id,resp_claro_id:this.bitacora.resp_claro.id}),this.getSites()})}getConfigBitacora(){this.configService.bitacoras().subscribe(e=>{this.tipo_Averia=e.tipoaveria,this.red=e.red,this.serv=e.serv})}getSites(){this.siteService.autocomplete().subscribe(e=>{this.setSites(e.data)})}getTableData(){this.brigadas=[],this.serialNumberArray=[],this.brigadasService.activa().subscribe(e=>{this.totalData=e.data.length,this.brigadasGeneral=e.data,this.getTableDataGeneral()})}getTableDataGeneral(){this.brigadas=[],this.serialNumberArray=[],this.brigadasGeneral.map((e,a)=>{const i=a+1;a>=this.skip&&i<=this.limit&&(this.brigadas.push(e),this.serialNumberArray.push(i))}),this.dataSource=new q.by(this.brigadas),this.calculateTotalPages(this.totalData,this.pageSize)}sortData(e){const a=this.brigadas.slice();this.brigadas=e.active&&""!==e.direction?a.sort((i,o)=>(i[e.active]<o[e.active]?-1:1)*("asc"===e.direction?1:-1)):a}getMoreData(e){"next"==e?(this.currentPage++,this.pageIndex=this.currentPage-1,this.limit+=this.pageSize,this.skip=this.pageSize*this.pageIndex,this.getTableDataGeneral()):"previous"==e&&(this.currentPage--,this.pageIndex=this.currentPage-1,this.limit-=this.pageSize,this.skip=this.pageSize*this.pageIndex,this.getTableDataGeneral())}moveToPage(e){this.currentPage=e,this.skip=this.pageSelection[e-1].skip,this.limit=this.pageSelection[e-1].limit,e>this.currentPage?this.pageIndex=e-1:e<this.currentPage&&(this.pageIndex=e+1),this.getTableDataGeneral()}PageSize(){this.pageSelection=[],this.limit=this.pageSize,this.skip=0,this.currentPage=1,this.searchDataValue="",this.getTableData()}calculateTotalPages(e,a){this.pageNumberArray=[],this.totalPages=e/a,this.totalPages%1!=0&&(this.totalPages=Math.trunc(this.totalPages+1));for(var i=1;i<=this.totalPages;i++){const o=a*i,s=o-a;this.pageNumberArray.push(i),this.pageSelection.push({skip:s,limit:o})}}countTecnicos(e){return e.user_movil.length}showSegment(e){this.brigadaSelected=e}addBrigada(e){const a=this.brigadasForm.get("brigadas"),o=a.value.findIndex(s=>s.id==e.id);-1!=o?a.removeAt(o):a.push(this.fb.group({id:[e.id],tipo:[e.tipo_brigada.nombre],zona:[e.zona.nombre]}))}searchadd(e){return-1==this.brigadasForm.value.brigadas.findIndex(o=>o.id==e.id)}setSites(e){this.sites=e,this.filteredSites=this.siteControl.valueChanges.pipe((0,M.O)(""),(0,w.U)(a=>a.length>=1?this._filter(a):[])),this.bitacora&&(this.site=this.sites.find(a=>a.id===this.bitacora.site.id),this.site&&this.onSetSite(this.site))}_filter(e){const a=e.toLowerCase();return this.sites.filter(i=>i.nombre.toLowerCase().includes(a))}displayFn(e){return e?e.nombre:void 0}onSetSite(e){this.bitacora&&(this.siteForm.patchValue({site_id:e.id}),this.bitacora.site=e,this.site=e,this.dataResponsables(e.zona.id))}dataResponsables(e){this.usuarioService.showResponsables(e).subscribe(a=>{console.log(a),this.responsables_cicsa=a.cicsa,this.responsables_claro=a.claro})}snackBar(e){this._snackBar.open(e,"Cerrar",{horizontalPosition:"right",verticalPosition:"top",duration:3e3})}saveBitacora(){if(!this.bitacora)return void console.error("No Bitacora was created");console.log(this.bitacora),console.log(this.datosForm.value);const e={...this.bitacora,...this.datosForm.value,...this.siteForm.value,...this.brigadasForm.value,...this.responsablesForm.value};console.log(e),this.bitacora.id?this.bitacoraService.update(this.bitacora.id,e).subscribe(a=>{console.log(a),403==a.message?this.snackBar("Falta ingresar datos"):(this.snackBar("Registro Exitoso"),this.router.navigate(["/bitacoras/list-bitacora"]))}):this.bitacoraService.create(e).subscribe(a=>{console.log(a),403==a.message?this.snackBar("Falta ingresar datos"):(this.snackBar("Registro Exitoso"),this.router.navigate(["/bitacoras/list-bitacora"]))})}onAddBrigada(){this.dialog.open(I.k).afterClosed().subscribe(()=>{this.getTableData()})}onDelete(){this.alertService.alert({title:"Borrar Bitacora",message:"\xbfEst\xe1s seguro de borrar la bitacora?",buttons:[{text:"Cancelar"},{text:"Borrar",color:"warn",action:()=>{this.bitacoraService.delete(this.bitacora.id).subscribe(()=>{this.snackBar("Bitacora Borrada"),this.router.navigate(["bitacoras/list-bitacora"])})}}]})}setStep(e){this.step=e}nextStep(){this.step++}prevStep(){this.step--}static#t=this.\u0275fac=function(a){return new(a||n)(t.Y36(O.E),t.Y36(b.k),t.Y36(Y.P),t.Y36(G.i),t.Y36(E.J),t.Y36(Z.ux),t.Y36(g.F0),t.Y36(g.gz),t.Y36(l.qu),t.Y36(d.uw),t.Y36(z))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-add-bitacoras"]],decls:267,vars:54,consts:[[1,"page-wrapper"],[1,"content"],[1,"page-header"],[1,"row"],[1,"col-sm-12"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#"],[1,"feather","icon-chevron-right"],[1,"breadcrumb-item","active"],[1,"card"],[1,"card-body"],[1,"example-headers-align"],["hideToggle","",3,"expanded","opened"],[1,"row","align-items-center",3,"formGroup"],[1,"col-12"],[1,"form-heading"],[1,"col-12","col-md-6","col-xl-4"],[1,"form-group","local-forms"],["for","nombre"],[1,"login-danger"],["formControlName","nombre","name","nombre","type","text",1,"form-control"],[1,"col-12","col-md-6","col-xl-2"],["for","fecha_inicial"],["formControlName","fecha_inicial","name","fecha_inicial","type","text","matInput","",1,"form-control",3,"matDatepicker"],["picker",""],["matIconSuffix","",1,"mt-4",3,"for"],["for","nro_sot"],["formControlName","sot","name","nro_sot","type","text",1,"form-control"],["for","nro_incidencia"],["formControlName","incidencia","name","nro_incidencia","type","text",1,"form-control"],["formControlName","tipo_averia_id","placeholder","Selec. Tipo Averia",1,"form-control","select"],[3,"value",4,"ngFor","ngForOf"],["for","latitud"],["formControlName","latitud","name","latitud","type","text",1,"form-control"],["for","longitud"],["formControlName","longitud","name","longitud","type","text",1,"form-control"],["for","distancia"],["formControlName","distancia","name","distancia","type","number",1,"form-control"],["for","selectedRed"],["formControlName","red_id","placeholder","Selec. Red1",1,"form-control","select"],["formControlName","serv_id","placeholder","Selec. Serv1",1,"form-control","select"],["mat-button","","color","primary",3,"disabled","click"],["type","text",1,"form-control",3,"formControl","matAutocomplete"],[3,"displayWith"],["auto","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],[1,"form-control",3,"value","disabled"],["for","cliente"],["formControlName","cliente","name","cliente","type","text",1,"form-control"],["mat-button","","color","warn",3,"click"],[1,"row","align-items-center"],[1,"table-responsive"],[1,"table","mb-0"],[1,"ml-auto","check-point","status-blue","me-1",3,"click"],[1,"feather","icon-plus"],[4,"ngFor","ngForOf"],[1,"table_footer"],[1,"col-sm-12","col-md-5"],[1,"dataTables_info"],[1,"col-sm-12","col-md-7"],[1,"pagination_section"],[1,"pagination"],[1,"page-item",3,"ngClass"],["href","javascript:void(0);","tabindex","-1",1,"page-link",3,"click"],["href","javascript:void(0);",1,"page-link",3,"click"],["class","col-12",4,"ngIf"],[1,"card-box"],[1,"card-block"],[1,"card-title"],[2,"text-align","center !important"],["aria-labelledby","example-radio-group-label","formControlName","resp_cicsa_id",1,"example-radio-group"],["class","example-radio-button",3,"value",4,"ngFor","ngForOf"],["aria-labelledby","example-radio-group-label","formControlName","resp_claro_id",1,"example-radio-group"],["class","col-12 d-flex",4,"ngIf"],[3,"value"],[3,"value","click"],[1,"add-group"],[1,"check-point","status-blue","me-1",3,"click"],[1,"feather","icon-search"],["class","check-point status-blue",3,"click",4,"ngIf"],[1,"check-point","status-blue",3,"click"],["class","page-item","tabindex","0",3,"hidden","click","keyup.enter",4,"ngIf"],["tabindex","0",1,"page-item",3,"hidden","click","keyup.enter"],["href","javascript:void(0);",1,"page-link"],[4,"ngIf"],[1,"check-point","status-red",3,"click"],[1,"feather","icon-x"],[1,"example-radio-button",3,"value"],[1,"col-12","d-flex"],["mat-button","","color","warn",1,"ms-auto","mt-2",3,"click"]],template:function(a,i){if(1&a&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"ul",5)(6,"li",6)(7,"a",7),t._uU(8,"Bitacoras "),t.qZA()(),t.TgZ(9,"li",6),t._UZ(10,"i",8),t.qZA(),t.TgZ(11,"li",9),t._uU(12,"Agregar Bitacora"),t.qZA()()()()(),t.TgZ(13,"div",3)(14,"div",4)(15,"div",10)(16,"div",11)(17,"form")(18,"mat-accordion",12)(19,"mat-expansion-panel",13),t.NdJ("opened",function(){return i.setStep(0)}),t.TgZ(20,"mat-expansion-panel-header")(21,"mat-panel-title"),t._uU(22," Bitacora "),t.qZA(),t.TgZ(23,"mat-panel-description"),t._uU(24," Datos de Bitacora "),t.qZA()(),t.TgZ(25,"div",14)(26,"div",15)(27,"div",16)(28,"h4"),t._uU(29,"Agregar Bitacora"),t.qZA()()(),t.TgZ(30,"div",17)(31,"div",18)(32,"mat-label",19),t._uU(33," Nombre "),t.TgZ(34,"span",20),t._uU(35,"*"),t.qZA()(),t._UZ(36,"input",21),t.qZA()(),t.TgZ(37,"div",22)(38,"div",18)(39,"mat-label",23),t._uU(40,"Fecha Inicial "),t.TgZ(41,"span",20),t._uU(42,"*"),t.qZA()(),t._UZ(43,"input",24)(44,"mat-datepicker",null,25)(46,"mat-datepicker-toggle",26),t.qZA()(),t.TgZ(47,"div",22)(48,"div",18)(49,"mat-label",27),t._uU(50,"Nro Sot "),t.qZA(),t._UZ(51,"input",28),t.qZA()(),t.TgZ(52,"div",22)(53,"div",18)(54,"mat-label",29),t._uU(55,"Nro Incidencia "),t.qZA(),t._UZ(56,"input",30),t.qZA()(),t.TgZ(57,"div",22)(58,"div",18)(59,"mat-label"),t._uU(60,"Tipo Averia "),t.TgZ(61,"span",20),t._uU(62,"*"),t.qZA()(),t.TgZ(63,"mat-select",31),t.YNc(64,V,2,2,"mat-option",32),t.qZA()()(),t.TgZ(65,"div",22)(66,"div",18)(67,"mat-label",33),t._uU(68,"Latitud "),t.qZA(),t._UZ(69,"input",34),t.qZA()(),t.TgZ(70,"div",22)(71,"div",18)(72,"mat-label",35),t._uU(73,"Longitud "),t.qZA(),t._UZ(74,"input",36),t.qZA()(),t.TgZ(75,"div",22)(76,"div",18)(77,"mat-label",37),t._uU(78,"Distancia "),t.qZA(),t._UZ(79,"input",38),t.qZA()(),t.TgZ(80,"div",22)(81,"div",18)(82,"mat-label",39),t._uU(83,"Red1 "),t.TgZ(84,"span",20),t._uU(85,"*"),t.qZA()(),t.TgZ(86,"mat-select",40),t.YNc(87,R,2,2,"mat-option",32),t.qZA()()(),t.TgZ(88,"div",22)(89,"div",18)(90,"mat-label"),t._uU(91,"Serv1 "),t.TgZ(92,"span",20),t._uU(93,"*"),t.qZA()(),t.TgZ(94,"mat-select",41),t.YNc(95,W,2,2,"mat-option",32),t.qZA()()()(),t.TgZ(96,"mat-action-row")(97,"button",42),t.NdJ("click",function(){return i.nextStep()}),t._uU(98," Siguiente "),t.qZA()()(),t.TgZ(99,"mat-expansion-panel",13),t.NdJ("opened",function(){return i.setStep(1)}),t.TgZ(100,"mat-expansion-panel-header")(101,"mat-panel-title"),t._uU(102," Sites "),t.qZA(),t.TgZ(103,"mat-panel-description"),t._uU(104," Seleccionar Site "),t.qZA()(),t.TgZ(105,"div",14)(106,"div",15)(107,"div",16)(108,"h4"),t._uU(109,"Datos Site"),t.qZA()()(),t.TgZ(110,"div",22)(111,"div",18)(112,"mat-label"),t._uU(113,"Buscar Site"),t.qZA(),t._UZ(114,"input",43),t.TgZ(115,"mat-autocomplete",44,45),t.YNc(117,X,2,3,"mat-option",46),t.ALo(118,"async"),t.qZA()()(),t.TgZ(119,"div",22)(120,"div",18)(121,"mat-label"),t._uU(122,"C\xf3digo"),t.qZA(),t._UZ(123,"input",47),t.qZA()(),t.TgZ(124,"div",22)(125,"div",18)(126,"mat-label"),t._uU(127,"Zona"),t.qZA(),t._UZ(128,"input",47),t.qZA()(),t.TgZ(129,"div",22)(130,"div",18)(131,"mat-label",48),t._uU(132,"Cliente "),t.qZA(),t._UZ(133,"input",49),t.qZA()(),t.TgZ(134,"div",22)(135,"div",18)(136,"mat-label"),t._uU(137,"Region"),t.qZA(),t._UZ(138,"input",47),t.qZA()(),t.TgZ(139,"div",22)(140,"div",18)(141,"mat-label"),t._uU(142,"Departamento"),t.qZA(),t._UZ(143,"input",47),t.qZA()(),t.TgZ(144,"div",22)(145,"div",18)(146,"mat-label"),t._uU(147,"Provincia"),t.qZA(),t._UZ(148,"input",47),t.qZA()(),t.TgZ(149,"div",22)(150,"div",18)(151,"mat-label"),t._uU(152,"Distrito"),t.qZA(),t._UZ(153,"input",47),t.qZA()(),t.TgZ(154,"div",22)(155,"div",18)(156,"mat-label"),t._uU(157,"Latitud"),t.qZA(),t._UZ(158,"input",47),t.qZA()(),t.TgZ(159,"div",22)(160,"div",18)(161,"mat-label"),t._uU(162,"Longitud"),t.qZA(),t._UZ(163,"input",47),t.qZA()()(),t.TgZ(164,"mat-action-row")(165,"button",50),t.NdJ("click",function(){return i.prevStep()}),t._uU(166," Anterior "),t.qZA(),t.TgZ(167,"button",42),t.NdJ("click",function(){return i.nextStep()}),t._uU(168," Siguiente "),t.qZA()()(),t.TgZ(169,"mat-expansion-panel",13),t.NdJ("opened",function(){return i.setStep(2)}),t.TgZ(170,"mat-expansion-panel-header")(171,"mat-panel-title"),t._uU(172," Cuadrillas "),t.qZA(),t.TgZ(173,"mat-panel-description"),t._uU(174," Seleccionar cuadrillas "),t.qZA()(),t.TgZ(175,"div",51)(176,"div",15)(177,"div",10)(178,"div",11)(179,"div",52)(180,"table",53)(181,"thead")(182,"tr")(183,"th"),t._uU(184,"Contrata"),t.qZA(),t.TgZ(185,"th"),t._uU(186,"Cuadrilla"),t.qZA(),t.TgZ(187,"th"),t._uU(188,"Zona"),t.qZA(),t.TgZ(189,"th"),t._uU(190,"Tecnicos"),t.qZA(),t.TgZ(191,"th"),t._uU(192," Acci\xf3n "),t.TgZ(193,"button",54),t.NdJ("click",function(){return i.onAddBrigada()}),t._UZ(194,"i",55),t.qZA()()()(),t.TgZ(195,"tbody"),t.YNc(196,et,15,5,"ng-container",56),t.qZA()(),t.TgZ(197,"div",57)(198,"div",58)(199,"div",59),t._uU(200),t.qZA()(),t.TgZ(201,"div",60)(202,"div",61)(203,"ul",62)(204,"li",63)(205,"a",64),t.NdJ("click",function(){return i.getMoreData("previous")}),t._uU(206," Anterior "),t.qZA()(),t.YNc(207,nt,6,6,"ng-container",56),t.TgZ(208,"li",63)(209,"a",65),t.NdJ("click",function(){return i.getMoreData("next")}),t._uU(210,"Siguiente "),t.qZA()()()()()()()()()(),t.YNc(211,st,13,1,"div",66),t.qZA(),t.TgZ(212,"div",51)(213,"div",15)(214,"div",67)(215,"div",68)(216,"h4",69),t._uU(217,"Cuadrilla Seleccionada"),t.qZA(),t.TgZ(218,"div",52)(219,"table",53)(220,"thead")(221,"tr")(222,"th"),t._uU(223,"ZONA"),t.qZA(),t.TgZ(224,"th"),t._uU(225,"Cuadrilla"),t.qZA(),t.TgZ(226,"th"),t._uU(227,"ACCION"),t.qZA()()(),t.TgZ(228,"tbody"),t.YNc(229,ct,10,2,"ng-container",56),t.qZA()()()()()()(),t.TgZ(230,"mat-action-row")(231,"button",50),t.NdJ("click",function(){return i.prevStep()}),t._uU(232," Anterior "),t.qZA(),t.TgZ(233,"button",42),t.NdJ("click",function(){return i.nextStep()}),t._uU(234," Siguiente "),t.qZA()()(),t.TgZ(235,"mat-expansion-panel",13),t.NdJ("opened",function(){return i.setStep(3)}),t.TgZ(236,"mat-expansion-panel-header")(237,"mat-panel-title"),t._uU(238," Responsables "),t.qZA(),t.TgZ(239,"mat-panel-description"),t._uU(240," Seleccionar Responsables "),t.qZA()(),t.TgZ(241,"div",14)(242,"div",15)(243,"div",10)(244,"div",11)(245,"div",52)(246,"table",53)(247,"thead")(248,"tr")(249,"th"),t._uU(250,"Responsable Ciccsa"),t.qZA(),t.TgZ(251,"th"),t._uU(252,"Responsable Claro"),t.qZA()()(),t.TgZ(253,"tbody")(254,"tr")(255,"td",70)(256,"mat-radio-group",71),t.YNc(257,lt,2,3,"mat-radio-button",72),t.qZA()(),t.TgZ(258,"td",70)(259,"mat-radio-group",73),t.YNc(260,dt,2,3,"mat-radio-button",72),t.qZA()()()()()()()()()(),t.TgZ(261,"mat-action-row")(262,"button",50),t.NdJ("click",function(){return i.prevStep()}),t._uU(263," Anterior "),t.qZA(),t.TgZ(264,"button",42),t.NdJ("click",function(){return i.saveBitacora()}),t._uU(265," Registrar "),t.qZA()()()()(),t.YNc(266,pt,3,0,"div",74),t.qZA()()()()()()),2&a){const o=t.MAs(45),s=t.MAs(116);t.xp6(19),t.Q6J("expanded",0===i.step),t.xp6(6),t.Q6J("formGroup",i.datosForm),t.xp6(18),t.Q6J("matDatepicker",o),t.xp6(3),t.Q6J("for",o),t.xp6(18),t.Q6J("ngForOf",i.tipo_Averia),t.xp6(23),t.Q6J("ngForOf",i.red),t.xp6(8),t.Q6J("ngForOf",i.serv),t.xp6(2),t.Q6J("disabled",i.datosForm.invalid),t.xp6(2),t.Q6J("expanded",1===i.step),t.xp6(6),t.Q6J("formGroup",i.siteForm),t.xp6(9),t.Q6J("formControl",i.siteControl)("matAutocomplete",s),t.xp6(1),t.Q6J("displayWith",i.displayFn),t.xp6(2),t.Q6J("ngForOf",t.lcZ(118,48,i.filteredSites)),t.xp6(6),t.Q6J("value",null==i.site?null:i.site.codigo)("disabled",!0),t.xp6(5),t.Q6J("value",null==i.site||null==i.site.zona?null:i.site.zona.nombre)("disabled",!0),t.xp6(10),t.Q6J("value",null==i.site||null==i.site.region?null:i.site.region.nombre)("disabled",!0),t.xp6(5),t.Q6J("value",null==i.site||null==i.site.distrito||null==i.site.distrito.provincia||null==i.site.distrito.provincia.departamento?null:i.site.distrito.provincia.departamento.nombre)("disabled",!0),t.xp6(5),t.Q6J("value",null==i.site||null==i.site.distrito||null==i.site.distrito.provincia?null:i.site.distrito.provincia.nombre)("disabled",!0),t.xp6(5),t.Q6J("value",null==i.site||null==i.site.distrito?null:i.site.distrito.nombre)("disabled",!0),t.xp6(5),t.Q6J("value",null==i.site?null:i.site.latitud)("disabled",!0),t.xp6(5),t.Q6J("value",null==i.site?null:i.site.longitud)("disabled",!0),t.xp6(4),t.Q6J("disabled",i.siteForm.invalid),t.xp6(2),t.Q6J("expanded",2===i.step),t.xp6(27),t.Q6J("ngForOf",i.brigadas),t.xp6(4),t.lnq(" Mostrando ",i.serialNumberArray[0]," a ",i.serialNumberArray[i.serialNumberArray.length-1]," de ",i.totalData," cuadrillas "),t.xp6(4),t.Q6J("ngClass",t.VKq(50,J,1===i.currentPage)),t.xp6(3),t.Q6J("ngForOf",i.pageNumberArray),t.xp6(1),t.Q6J("ngClass",t.VKq(52,J,i.currentPage===i.pageNumberArray[i.pageNumberArray.length-1]||0===i.brigadas.length)),t.xp6(3),t.Q6J("ngIf",i.brigadaSelected),t.xp6(18),t.Q6J("ngForOf",i.brigadasForm.value.brigadas),t.xp6(4),t.Q6J("disabled",i.brigadasForm.invalid),t.xp6(2),t.Q6J("expanded",3===i.step),t.xp6(6),t.Q6J("formGroup",i.responsablesForm),t.xp6(16),t.Q6J("ngForOf",i.responsables_cicsa),t.xp6(3),t.Q6J("ngForOf",i.responsables_claro),t.xp6(4),t.Q6J("disabled",i.datosForm.invalid||i.siteForm.invalid||i.brigadasForm.invalid||i.responsablesForm.invalid),t.xp6(2),t.Q6J("ngIf",i.bitacora.id)}},dependencies:[p.mk,p.sg,p.O5,T.Mq,T.hl,T.nW,U.hX,U.R9,K.gD,H.ey,h.pp,h.ib,h.VG,h.yz,h.yK,h.u4,v.lW,j.Nt,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.F,B.XC,B.ZL,y.VQ,y.U0,l.oH,l.sg,l.u,p.Ov],styles:[".mat-mdc-form-field[_ngcontent-%COMP%] + .mat-mdc-form-field[_ngcontent-%COMP%]{margin-left:8px}.example-form[_ngcontent-%COMP%]{min-width:150px;max-width:500px;width:100%}.example-full-width[_ngcontent-%COMP%]{width:100%}.example-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0;align-items:flex-start}.example-radio-button[_ngcontent-%COMP%]{margin:5px}"]})}return n})();var _t=c(3583),ut=c(9909),mt=c(342);const gt=["invoiceTotalInner"];function ht(n,r){if(1&n&&(t.TgZ(0,"pre"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.qoO(["    #*",e.bitacora.nombre,"*\n_FechaInicial:_ ",e.bitacora.fecha_inicial,"\n_NroSot:_ ",e.bitacora.sot,";\n_NroIncidencia:_ ",e.bitacora.incidencia,";\n_TipoAveria:_ ",e.bitacora.tipo_averia.nombre," ;\n_TipoSitePop:_ ",e.bitacora.site.tipo_site.nombre,";\n_NombreSite:_ *",e.bitacora.site.nombre,"*;\n_NombreCliente:_ *",e.bitacora.cliente,"*;\n_Lat:_ ",e.bitacora.latitud," , _Lon:_ ",e.bitacora.longitud,";\n_Distancia:_ ",e.bitacora.distancia,"Kms;\n_Region:_ ",e.bitacora.site.region,"; \n_Departamento:_ ",e.bitacora.site.departamento.nombre,";\n_Distrito:_ ",e.bitacora.site.distrito.nombre,"; \n_red1:_ ",e.bitacora.red.nombre,";\n_serv1:_ ",e.bitacora.serv.nombre,",",e.brigadas,"\n_Responsable Cicsa:_ ",e.bitacora.resp_cicsa.nombres," -T: ",e.bitacora.resp_cicsa.telefono,"; \n_Responsable Claro:_ ",e.bitacora.resp_claro.nombres," -T: ",e.bitacora.resp_claro.telefono,";\n\n",e.causas,"\n",e.atenciones,"\n                "])}}let x=(()=>{class n{constructor(e,a,i,o,s){this.dialogRef=e,this.data=a,this.clipboard=i,this._snackBar=o,this.bitacoraService=s,this.brigadas="",this.atenciones="",this.causas="",this.count=1,this.bitacoraService.read(a.id).subscribe(u=>{console.log("la bitacora: ",u),this.bitacora=u,this.count=1,"0"==this.bitacora.estado&&(this.causas="*Causa: "+this.bitacora.causa_averia.nombre+";* \n",this.causas=this.causas+"*Consecuencia: "+this.bitacora.consecuencia_averia.nombre+";* \n",this.causas=this.causas+"*Tipo de Reparaci\xf3n:* "+this.bitacora.tipo_reparacion.nombre+"; \n",this.causas=this.causas+"*Tiempo de soluci\xf3n:* "+this.bitacora.tiempo_solucion+"; \n",this.causas=this.bitacora.herramientas?this.causas+"\n*Material Utilizado:*\n"+this.bitacora.herramientas+"\n":this.causas+"\n*Material Utilizado:*\n - Sin materiales \n"),this.bitacora?.brigadas.forEach(m=>{m.user_movil.forEach(_=>{"1"==_.is_lider&&(this.brigadas=this.brigadas+"\n_Bri"+this.count+":_ "+m.zona.nombre+": "+_.user.nombre+" - Placa: "+_.unidad_movil?.placa+" Cel: "+_.user.celular,this.count=this.count+1)})}),this.bitacora?.atenciones.forEach(m=>{m.bitacora_atencion.forEach(_=>{this.atenciones="0"==_.is_coment?this.atenciones+" *"+_.hora+"* "+_.descripcion+" \n":this.atenciones+"   *-* "+_.descripcion+" \n"}),this.atenciones=this.atenciones+" *"+m.hora+" ("+m.atencion.orden+") "+m.atencion.descripcion+"* "+m.descripcion+" \n"})})}copiarTexto(){this.clipboard.copy(this.invoiceTotalInner.nativeElement.innerText),this._snackBar.open("Bicatora copiada","Cerrar",{horizontalPosition:"right",verticalPosition:"top",duration:3e3})}static#t=this.\u0275fac=function(a){return new(a||n)(t.Y36(d.so),t.Y36(d.WI),t.Y36(mt.TU),t.Y36(Z.ux),t.Y36(b.k))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-view-bitacoras"]],viewQuery:function(a,i){if(1&a&&t.Gf(gt,7),2&a){let o;t.iGM(o=t.CRH())&&(i.invoiceTotalInner=o.first)}},decls:20,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"invoice-total-card"],[1,"invoice-total-title"],["href","javascript:void(0);",1,"me-2",3,"click"],[1,"fas","fa-clone"],[1,"invoice-total-box"],[1,"invoice-total-inner"],["invoiceTotalInner",""],[4,"ngIf"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"click"],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"],[1,"fab","fa-whatsapp"]],template:function(a,i){1&a&&(t.TgZ(0,"h2",0),t._uU(1,"Detalle Bitacora"),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"h4",3),t._uU(5,"Copiar el texto al chat WhatsApp"),t.qZA(),t.TgZ(6,"a",4),t.NdJ("click",function(){return i.copiarTexto()}),t._UZ(7,"i",5),t.qZA(),t.TgZ(8,"div",6)(9,"div",7,8),t.YNc(11,ht,2,23,"pre",9),t.qZA()()()(),t.TgZ(12,"mat-dialog-actions",10)(13,"button",11),t._uU(14,"Cerrar"),t.qZA(),t.TgZ(15,"button",12),t.NdJ("click",function(){return i.copiarTexto()}),t._UZ(16,"i",5),t.qZA(),t.TgZ(17,"button",13),t._UZ(18,"i",14),t._uU(19," WhatsApp "),t.qZA()()),2&a&&(t.xp6(11),t.Q6J("ngIf",i.bitacora),t.xp6(6),t.Q6J("mat-dialog-close",!0))},dependencies:[p.O5,v.lW,d.ZT,d.uh,d.xY,d.H8]})}return n})();var bt=c(3586),N=c(3566),S=c(2596);const ft=function(n){return["/bitacoras/edit-bitacora/",n]};function Zt(n,r){if(1&n&&(t.TgZ(0,"button",49),t._UZ(1,"i",56),t.qZA()),2&n){const e=t.oxw().$implicit;t.Q6J("disabled","0"===e.estado)("routerLink",t.VKq(2,ft,e.id))}}function vt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",57)(1,"i",58),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,o=t.oxw();return t.KtG(o.openDialog(i.id))}),t.qZA()()}}const Tt=function(n,r){return{"status-red":n,"status-green":r}},At=function(n){return["/bitacoras/list-bitacora/detalle-bitacora/",n]};function xt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"tr")(1,"td",46),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td")(16,"a",47),t._uU(17),t.qZA()(),t.TgZ(18,"td",48)(19,"button",49),t._UZ(20,"i",50),t.qZA(),t.TgZ(21,"button",51)(22,"i",52),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.openDialogLocation(o))}),t.qZA()(),t.TgZ(23,"button",51)(24,"i",53),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.openDialogEnd(o))}),t.qZA()(),t.YNc(25,Zt,2,4,"button",54),t.YNc(26,vt,2,0,"button",55),t.qZA()()}if(2&n){const e=r.$implicit,a=t.oxw();t.xp6(1),t.Q6J("matTooltip",e.nombre),t.xp6(1),t.hij(" ",e.nombre," "),t.xp6(2),t.Oqu(e.fecha_inicial),t.xp6(2),t.Oqu(e.sot),t.xp6(2),t.Oqu(e.incidencia),t.xp6(2),t.Oqu(e.tipo_averia.nombre),t.xp6(2),t.Oqu(e.red.nombre),t.xp6(2),t.Oqu(e.serv.nombre),t.xp6(2),t.Q6J("ngClass",t.WLB(16,Tt,"1"===e.estado,"0"===e.estado)),t.xp6(1),t.Oqu(e.estadotext),t.xp6(2),t.Q6J("disabled","0"===e.estado)("routerLink",t.VKq(19,At,e.id)),t.xp6(2),t.Q6J("disabled","0"===e.estado),t.xp6(2),t.Q6J("disabled","0"===e.estado),t.xp6(2),t.Q6J("ngIf","Tecnico"!==(null==a.user||null==a.user.roles?null:a.user.roles[0])),t.xp6(1),t.Q6J("ngIf","Tecnico"!==(null==a.user||null==a.user.roles?null:a.user.roles[0]))}}function Ct(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"li",60),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.moveToPage(i.currentPage-2))})("keyup.enter",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.moveToPage(i.currentPage-2))}),t.TgZ(1,"a",61),t._uU(2," ... "),t.qZA()()}if(2&n){const e=t.oxw(2);t.Q6J("hidden",1===e.currentPage)}}function kt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"li",60),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.moveToPage(i.currentPage+2))})("keyup.enter",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.moveToPage(i.currentPage+2))}),t.TgZ(1,"a",61),t._uU(2," ... "),t.qZA()()}if(2&n){const e=t.oxw(2);t.Q6J("hidden",e.currentPage>=e.pageNumberArray[e.pageNumberArray.length-2]||e.totalData<e.serialNumberArray[e.serialNumberArray.length-1])}}function qt(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"li",43)(2,"a",45),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.moveToPage(o))}),t._uU(3),t.qZA()(),t.YNc(4,Ct,3,1,"li",59),t.YNc(5,kt,3,1,"li",59),t.BQk()}if(2&n){const e=r.$implicit,a=r.index,i=t.oxw();t.xp6(1),t.ekj("active",e===i.currentPage),t.Q6J("ngClass",i.pageNumberArray[i.currentPage-2]>e&&1!==e&&i.pageNumberArray.length>6||i.pageNumberArray[i.currentPage]<e&&1!==e&&i.pageNumberArray.length>6&&i.pageNumberArray.length!==e?"hide-page-no":"show-page-no"),t.xp6(2),t.hij(" ",e," "),t.xp6(1),t.Q6J("ngIf",0===a&&i.pageNumberArray.length>6&&i.currentPage>2),t.xp6(1),t.Q6J("ngIf",a===i.pageNumberArray.length-2&&i.pageNumberArray.length>6)}}const F=function(n){return{disabled:n}};let Ut=(()=>{class n{constructor(e,a,i){this.bitacoraService=e,this.dialog=a,this.auth=i,this.bitacoras=[],this.showFilter=!1,this.searchDataValue="",this.lastIndex=0,this.pageSize=10,this.totalData=0,this.skip=0,this.limit=this.pageSize,this.pageIndex=0,this.serialNumberArray=[],this.currentPage=1,this.pageNumberArray=[],this.pageSelection=[],this.totalPages=0,this.bitacora_generals=[]}ngOnInit(){this.user=this.auth.user,console.log(this.user),this.getTableData()}getTableData(e=1){this.serialNumberArray=[],this.bitacoraService.readAll({page:e,search:this.searchDataValue}).subscribe(a=>{console.log(a),this.totalData=a.total,this.bitacoras=a.data,this.dataSource=new q.by(this.bitacoras),this.calculateTotalPages(this.totalData,this.pageSize)})}searchData(){this.pageSelection=[],this.limit=this.pageSize,this.skip=0,this.currentPage=1,this.getTableData()}sortData(e){const a=this.bitacoras.slice();this.bitacoras=e.active&&""!==e.direction?a.sort((i,o)=>(i[e.active]<o[e.active]?-1:1)*("asc"===e.direction?1:-1)):a}getMoreData(e){"next"==e?(this.currentPage++,this.pageIndex=this.currentPage-1,this.limit+=this.pageSize,this.skip=this.pageSize*this.pageIndex,this.getTableData(this.currentPage)):"previous"==e&&(this.currentPage--,this.pageIndex=this.currentPage-1,this.limit-=this.pageSize,this.skip=this.pageSize*this.pageIndex,this.getTableData(this.currentPage))}moveToPage(e){this.currentPage=e,this.skip=this.pageSelection[e-1].skip,this.limit=this.pageSelection[e-1].limit,e>this.currentPage?this.pageIndex=e-1:e<this.currentPage&&(this.pageIndex=e+1),this.getTableData(this.currentPage)}PageSize(){this.pageSelection=[],this.limit=this.pageSize,this.skip=0,this.currentPage=1,this.searchDataValue="",this.getTableData()}calculateTotalPages(e,a){this.pageNumberArray=[],this.totalPages=e/a,this.totalPages%1!=0&&(this.totalPages=Math.trunc(this.totalPages+1));for(var i=1;i<=this.totalPages;i++){const o=a*i,s=o-a;this.pageNumberArray.push(i),this.pageSelection.push({skip:s,limit:o})}}openDialog(e){this.dialog.open(x,{data:{id:e}})}openDialogEnd(e){this.dialog.open(_t.a,{data:{bitacora:e}})}openDialogLocation(e){this.dialog.open(ut.D,{data:{bitacora:e}})}static#t=this.\u0275fac=function(a){return new(a||n)(t.Y36(b.k),t.Y36(d.uw),t.Y36(bt.e))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-list-bitacoras"]],decls:72,vars:12,consts:[[1,"page-wrapper"],[1,"content"],[1,"page-header"],[1,"row"],[1,"col-sm-12"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#"],[1,"feather","icon-chevron-right"],[1,"breadcrumb-item","active"],[1,"card","card-table","show-entire"],[1,"card-body"],[1,"page-table-header","mb-2"],[1,"row","align-items-center"],[1,"col"],[1,"doctor-table-blk"],[1,"doctor-search-blk"],[1,"top-nav-search","table-search-blk"],["placeholder","Search here",1,"form-control",3,"ngModel","ngModelChange","keyup.enter"],[1,"btn"],["src","assets/img/icons/search-normal.svg","alt",""],[1,"add-group"],["routerLink","/bitacoras/add-bitacora",1,"btn","btn-primary","add-pluss","ms-2"],["src","assets/img/icons/plus.svg","alt",""],["href","javascript:;",1,"btn","btn-primary","doctor-refresh","ms-2",3,"click"],["src","assets/img/icons/re-fresh.svg","alt",""],[1,"table-responsive"],["matSort","",1,"table","border-0","custom-table","comman-table","datatable","mb-0",3,"matSortChange"],["mat-sort-header","nombre",1,"col-sm-4"],["mat-sort-header","fecha_inicial"],["mat-sort-header","sot"],["mat-sort-header","incidencia"],["mat-sort-header","tipo_averia"],["mat-sort-header","red"],["mat-sort-header","serv"],["mat-sort-header","estado"],[4,"ngFor","ngForOf"],[1,"table_footer"],[1,"col-sm-12","col-md-5"],[1,"dataTables_info"],[1,"col-sm-12","col-md-7"],[1,"pagination_section","mx-2"],[1,"pagination"],[1,"page-item",3,"ngClass"],["href","javascript:void(0);","tabindex","-1",1,"page-link",3,"click"],["href","javascript:void(0);",1,"page-link",3,"click"],[2,"max-width","24rem","text-overflow","ellipsis","white-space","nowrap","overflow","hidden",3,"matTooltip"],[1,"custom-badge",3,"ngClass"],[1,"text-end"],[1,"btn","btn-primary","ms-1",3,"disabled","routerLink"],[1,"fa","fa-clock"],[1,"btn","btn-primary","ms-1",3,"disabled"],["aria-hidden","true",1,"fas","fa-map-marker-alt",3,"click"],["aria-hidden","true",1,"fa","fa-check",3,"click"],["class","btn btn-primary ms-1",3,"disabled","routerLink",4,"ngIf"],["class","btn btn-primary ms-1",4,"ngIf"],[1,"fa","fa-pencil"],[1,"btn","btn-primary","ms-1"],["aria-hidden","true",1,"fa","fa-eye",3,"click"],["class","page-item","tabindex","0",3,"hidden","click","keyup.enter",4,"ngIf"],["tabindex","0",1,"page-item",3,"hidden","click","keyup.enter"],["href","javascript:void(0);",1,"page-link"]],template:function(a,i){1&a&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"ul",5)(6,"li",6)(7,"a",7),t._uU(8,"Bitacoras "),t.qZA()(),t.TgZ(9,"li",6),t._UZ(10,"i",8),t.qZA(),t.TgZ(11,"li",9),t._uU(12,"Lista de Bitacoras"),t.qZA()()()()(),t.TgZ(13,"div",3)(14,"div",4)(15,"div",10)(16,"div",11)(17,"div",12)(18,"div",13)(19,"div",14)(20,"div",15)(21,"h3"),t._uU(22,"Listado de Bitacoras"),t.qZA(),t.TgZ(23,"div",16)(24,"div",17)(25,"input",18),t.NdJ("ngModelChange",function(s){return i.searchDataValue=s})("keyup.enter",function(){return i.searchData()}),t.qZA(),t.TgZ(26,"a",19),t._UZ(27,"img",20),t.qZA()(),t.TgZ(28,"div",21)(29,"a",22),t._UZ(30,"img",23),t.qZA(),t.TgZ(31,"a",24),t.NdJ("click",function(){return i.PageSize()}),t._UZ(32,"img",25),t.qZA()()()()()()(),t.TgZ(33,"div",26)(34,"table",27),t.NdJ("matSortChange",function(s){return i.sortData(s)}),t.TgZ(35,"thead")(36,"tr")(37,"th",28),t._uU(38,"Nombre"),t.qZA(),t.TgZ(39,"th",29),t._uU(40,"Fecha"),t.qZA(),t.TgZ(41,"th",30),t._uU(42,"SOT"),t.qZA(),t.TgZ(43,"th",31),t._uU(44,"Incidencia"),t.qZA(),t.TgZ(45,"th",32),t._uU(46,"Tipo Averia"),t.qZA(),t.TgZ(47,"th",33),t._uU(48,"Red"),t.qZA(),t.TgZ(49,"th",34),t._uU(50,"Serv"),t.qZA(),t.TgZ(51,"th",35),t._uU(52,"Estado"),t.qZA(),t.TgZ(53,"th"),t._uU(54,"Acci\xf3n"),t.qZA(),t._UZ(55,"th"),t.qZA()(),t.TgZ(56,"tbody"),t.YNc(57,xt,27,21,"tr",36),t.qZA()(),t.TgZ(58,"div",37)(59,"div",38)(60,"div",39),t._uU(61),t.qZA()(),t.TgZ(62,"div",40)(63,"div",41)(64,"ul",42)(65,"li",43)(66,"a",44),t.NdJ("click",function(){return i.getMoreData("previous")}),t._uU(67,"Anterior"),t.qZA()(),t.YNc(68,qt,6,6,"ng-container",36),t.TgZ(69,"li",43)(70,"a",45),t.NdJ("click",function(){return i.getMoreData("next")}),t._uU(71,"Siguiente "),t.qZA()()()()()()()()()()()()()),2&a&&(t.xp6(25),t.Q6J("ngModel",i.searchDataValue),t.xp6(32),t.Q6J("ngForOf",i.bitacoras),t.xp6(4),t.lnq(" Mostrando ",i.serialNumberArray[0]," a ",i.serialNumberArray[i.serialNumberArray.length-1]," de ",i.totalData," bitacoras "),t.xp6(4),t.Q6J("ngClass",t.VKq(8,F,1===i.currentPage)),t.xp6(3),t.Q6J("ngForOf",i.pageNumberArray),t.xp6(1),t.Q6J("ngClass",t.VKq(10,F,i.currentPage===i.pageNumberArray[i.pageNumberArray.length-1]||0===i.bitacoras.length)))},dependencies:[p.mk,p.sg,p.O5,g.rH,l.Fj,l.JJ,l.On,N.YE,N.nU,S.gM],styles:["section[_ngcontent-%COMP%]{display:table}.example-label[_ngcontent-%COMP%]{display:table-cell;font-size:14px;margin-left:8px;min-width:120px}.example-button-row[_ngcontent-%COMP%]{display:table-cell;max-width:600px}.example-button-row[_ngcontent-%COMP%]   .mat-mdc-button-base[_ngcontent-%COMP%]{margin:8px 8px 8px 0}.example-flex-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;flex-wrap:wrap}.example-button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;width:120px}"]})}return n})();var C=c(5195);function Bt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"a")(1,"i",19),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,o=t.oxw();return t.KtG(o.addItemAtencion(i))}),t.qZA()()}}function yt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",31),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().index,o=t.oxw().$implicit,s=t.oxw();return t.KtG(s.deleteItem(o,i))}),t._UZ(1,"i",32),t.qZA()}}const f=function(){return{standalone:!0}};function Jt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",35)(1,"div",22),t._UZ(2,"label",23),t.TgZ(3,"input",24),t.NdJ("ngModelChange",function(i){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.hora=i)}),t.qZA()()()}if(2&n){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("for",e.hora),t.xp6(1),t.Q6J("name",e.hora)("ngModel",e.hora)("ngModelOptions",t.DdM(4,f))}}function Nt(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",20),t.YNc(2,Jt,4,5,"div",33),t.TgZ(3,"div",34)(4,"div",22),t._UZ(5,"label",23),t.TgZ(6,"textarea",26),t.NdJ("ngModelChange",function(i){const s=t.CHM(e).$implicit;return t.KtG(s.descripcion=i)}),t.qZA()()(),t.TgZ(7,"div",21)(8,"button",28)(9,"i",29),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,o=t.oxw(2);return t.KtG(o.addItem(i,"1"))}),t.qZA()(),t.TgZ(10,"button",28)(11,"i",19),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,o=t.oxw(2);return t.KtG(o.addItem(i,"0"))}),t.qZA()(),t.TgZ(12,"button",31),t.NdJ("click",function(){const o=t.CHM(e).index,s=t.oxw().$implicit,u=t.oxw(2);return t.KtG(u.deleteItemHijo(s,o))}),t._UZ(13,"i",32),t.qZA()()(),t.BQk()}if(2&n){const e=r.$implicit,a=t.oxw().$implicit,i=t.oxw(2);t.xp6(2),t.Q6J("ngIf","0"===e.is_coment),t.xp6(1),t.ekj("col-xl-7","0"===e.is_coment)("col-xl-9","1"===e.is_coment)("col-md-6","0"===e.is_coment)("col-md-8","1"===e.is_coment)("offset-xl-1","1"===e.is_coment)("offset-md-1","1"===e.is_coment),t.xp6(2),t.Q6J("for",e.descripcion),t.xp6(1),t.Q6J("name",e.descripcion)("ngModel",e.descripcion)("ngModelOptions",t.DdM(19,f)),t.xp6(2),t.Q6J("disabled",!i.valida(a)),t.xp6(2),t.Q6J("disabled",!i.valida(a))}}function St(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",20)(2,"div",21)(3,"div",22),t._UZ(4,"label",23),t.TgZ(5,"input",24),t.NdJ("ngModelChange",function(i){const s=t.CHM(e).$implicit;return t.KtG(s.hora=i)}),t.qZA()()(),t.TgZ(6,"div",25)(7,"div",22),t._UZ(8,"label",23),t.TgZ(9,"textarea",26),t.NdJ("ngModelChange",function(i){const s=t.CHM(e).$implicit;return t.KtG(s.descripcion=i)}),t.qZA()()(),t.TgZ(10,"div",27)(11,"button",28)(12,"i",29),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.addItem(o,"1"))}),t.qZA()(),t.TgZ(13,"button",28)(14,"i",19),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.addItem(o,"0"))}),t.qZA()(),t.YNc(15,yt,2,0,"button",30),t.qZA()(),t.YNc(16,Nt,14,20,"ng-container",14),t.BQk()}if(2&n){const e=r.$implicit;t.xp6(4),t.Q6J("for",e.hora),t.xp6(1),t.Q6J("name",e.hora)("ngModel",e.hora)("ngModelOptions",t.DdM(12,f)),t.xp6(3),t.Q6J("for",e.descripcion),t.xp6(1),t.Q6J("name",e.descripcion)("ngModel",e.descripcion)("ngModelOptions",t.DdM(13,f)),t.xp6(2),t.Q6J("disabled",!(""!==e.descripcion&&""!==e.hora)),t.xp6(2),t.Q6J("disabled",!(""!==e.descripcion&&""!==e.hora)),t.xp6(2),t.Q6J("ngIf",0===(null==e.bitacora_atencion?null:e.bitacora_atencion.length)),t.xp6(1),t.Q6J("ngForOf",e.bitacora_atencion)}}function Ft(n,r){if(1&n&&(t.ynx(0),t.TgZ(1,"mat-card-header")(2,"mat-card-title"),t._uU(3),t.YNc(4,Bt,2,0,"a",18),t.qZA()(),t.TgZ(5,"mat-card-content"),t.YNc(6,St,17,14,"ng-container",14),t.qZA(),t.BQk()),2&n){const e=r.$implicit;t.xp6(3),t.AsE(" (",e.orden,") ",e.descripcion," "),t.xp6(1),t.Q6J("ngIf",0===(null==e.bitacora_atencion?null:e.bitacora_atencion.length)),t.xp6(2),t.Q6J("ngForOf",e.bitacora_atencion)}}const Pt=[{path:"",component:P,children:[{path:"list-bitacora",component:Ut},{path:"add-bitacora",component:A},{path:"edit-bitacora",component:A},{path:"view-bitacora",component:x},{path:"edit-bitacora/:id",component:A},{path:"view-bitacora",component:x},{path:"list-bitacora/detalle-bitacora/:bitacora",component:(()=>{class n{constructor(e,a,i,o){this.bitacorasServices=e,this.activeRoute=a,this._snackBar=i,this.router=o,this.itemDetails=[0],this.atenciones=[],this.bitacora_id=0}ngOnInit(){this.activeRoute.params.subscribe(e=>{this.bitacora_id=e.bitacora}),this.bitacorasServices.listAtencion(this.bitacora_id).subscribe(e=>{this.atenciones=e.data})}addItemAtencion(e){0==e.bitacora_atencion.length&&e.bitacora_atencion?.push({id:0,hora:"",descripcion:"",orden:e.orden,is_coment:"0",atencion_id:e.id,bitacora_id:this.bitacora_id,parent_id:0,bitacora_atencion:[]})}valida(e){return"0"==e.bitacora_atencion.at(-1)?.is_coment?""!=e.bitacora_atencion.at(-1)?.descripcion&&""!=e.bitacora_atencion.at(-1)?.hora:""!=e.bitacora_atencion.at(-1)?.descripcion}addItem(e,a){this.valida(e)?e.bitacora_atencion?.push({id:0,hora:"",descripcion:"",is_coment:a,orden:e.bitacora_atencion.length+1,atencion_id:e.atencion_id,bitacora_id:e.bitacora_id,parent_id:e.atencion_id,bitacora_atencion:[]}):this.snackBar("Falta completar datos")}deleteItemHijo(e,a){e.bitacora_atencion?.splice(a,1),e.bitacora_atencion?.forEach((i,o)=>i.orden=o+1)}deleteItem(e,a){e.bitacora_atencion.splice(a,1)}guardar(){console.log(this.atenciones);const e=new FormData;e.append("id",""+this.bitacora_id),e.append("atenciones",JSON.stringify(this.atenciones)),this.bitacorasServices.createAtencionBitacora(e).subscribe(a=>{console.log(a),403==a.message?this.snackBar("Falta ingresar datos"):(this.snackBar("Registro Exitoso"),this.router.navigate(["/bitacoras/list-bitacora"]))})}cancel(){this.router.navigate(["/bitacoras/list-bitacora"])}snackBar(e){this._snackBar.open(e,"Cerrar",{horizontalPosition:"right",verticalPosition:"top",duration:3e3})}static#t=this.\u0275fac=function(a){return new(a||n)(t.Y36(b.k),t.Y36(g.gz),t.Y36(Z.ux),t.Y36(g.F0))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-add-detalle-bitacoras"]],decls:30,vars:1,consts:[[1,"page-wrapper"],[1,"content"],[1,"page-header"],[1,"row"],[1,"col-sm-12"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#"],[1,"feather","icon-chevron-right"],[1,"breadcrumb-item","active"],[1,"card"],[1,"card-body"],[1,"col-12"],[1,"form-heading"],[4,"ngFor","ngForOf"],[1,"doctor-submit","text-end"],["type","button",1,"btn","btn-primary","submit-form","me-2",3,"click"],["type","submit",1,"btn","btn-primary","cancel-form",3,"click"],[4,"ngIf"],["aria-hidden","true",1,"fas","fa-plus-circle",3,"click"],[1,"row","align-items-center"],[1,"col-12","col-md-3","col-xl-2",2,"height","50px"],[1,"form-group","local-forms"],[3,"for"],["type","time",1,"form-control",3,"name","ngModel","ngModelOptions","ngModelChange"],[1,"col-12","col-md-6","col-xl-8",2,"height","50px"],["rows","1","cols","10",1,"form-control",3,"name","ngModel","ngModelOptions","ngModelChange"],[1,"col-12","col-md-3","col-xl-2","space-x-4","flex",2,"height","50px"],[1,"btn","btn-primary","ms-1",3,"disabled"],["aria-hidden","true",1,"fa-solid","fa-comment",3,"click"],["class","btn btn-primary ms-1","aria-hidden","true",3,"click",4,"ngIf"],["aria-hidden","true",1,"btn","btn-primary","ms-1",3,"click"],[1,"fas","fa-trash-alt"],["class","col-12 col-md-2 col-xl-2 offset-md-1 offset-xl-1","style","height: 50px;",4,"ngIf"],[1,"col-12",2,"height","50px"],[1,"col-12","col-md-2","col-xl-2","offset-md-1","offset-xl-1",2,"height","50px"]],template:function(a,i){1&a&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"ul",5)(6,"li",6)(7,"a",7),t._uU(8,"Bitacoras"),t.qZA()(),t.TgZ(9,"li",6),t._UZ(10,"i",8),t.qZA(),t.TgZ(11,"li",9),t._uU(12,"Agregar Tareas Bitacora"),t.qZA()()()()(),t.TgZ(13,"div",3)(14,"div",4)(15,"div",10)(16,"div",11)(17,"form")(18,"div",3)(19,"div",12)(20,"div",13)(21,"h4"),t._uU(22,"Desarrollo de la atenci\xf3n de averia : "),t.qZA()()(),t.YNc(23,Ft,7,4,"ng-container",14),t.TgZ(24,"div",12)(25,"div",15)(26,"button",16),t.NdJ("click",function(){return i.guardar()}),t._uU(27,"Guardar"),t.qZA(),t.TgZ(28,"button",17),t.NdJ("click",function(){return i.cancel()}),t._uU(29,"Cancel"),t.qZA()()()()()()()()()()()),2&a&&(t.xp6(23),t.Q6J("ngForOf",i.atenciones))},dependencies:[p.sg,p.O5,C.dn,C.dk,C.n5,l._Y,l.Fj,l.JJ,l.JL,l.On,l.F]})}return n})()}]}];let Qt=(()=>{class n{static#t=this.\u0275fac=function(a){return new(a||n)};static#e=this.\u0275mod=t.oAB({type:n});static#i=this.\u0275inj=t.cJS({imports:[g.Bz.forChild(Pt),g.Bz]})}return n})();var Dt=c(15),Mt=c(9862),wt=c(6736);let It=(()=>{class n{static#t=this.\u0275fac=function(a){return new(a||n)};static#e=this.\u0275mod=t.oAB({type:n});static#i=this.\u0275inj=t.cJS({imports:[p.ez,Qt,Dt.m,wt.q,l.u5,l.UX,Mt.JF,g.Bz,S.AV]})}return n})()}}]);