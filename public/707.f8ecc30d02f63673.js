"use strict";(self.webpackChunkpreclinic_angular=self.webpackChunkpreclinic_angular||[]).push([[707],{3583:(L,v,s)=>{s.d(v,{a:()=>g});var d=s(7700),t=s(5879),C=s(342),f=s(2939),m=s(2893),b=s(3059),i=s(1303),n=s(6223),o=s(3432),a=s(6814),e=s(9157),u=s(8525),h=s(3680),E=s(2296);function T(_,l){if(1&_&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&_){const r=l.$implicit;t.Q6J("value",r.id),t.xp6(1),t.hij(" ",r.nombre," ")}}function D(_,l){if(1&_&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&_){const r=l.$implicit;t.Q6J("value",r.id),t.xp6(1),t.hij(" ",r.nombre," ")}}function $(_,l){if(1&_&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&_){const r=l.$implicit;t.Q6J("value",r.id),t.xp6(1),t.hij(" ",r.nombre," ")}}let g=(()=>{class _{constructor(r,c,p,y,O,P,M,A,U){this.dialogRef=r,this.data=c,this.clipboard=p,this._snackBar=y,this.bitacoraService=O,this.configService=P,this.router=M,this.fb=A,this.utilities=U,this.herramientas="",this.tiempo="",this.causa=[],this.consecuencia=[],this.tipoReparacion=[],this.bitacora=c.bitacora,this.datosForm=this.fb.group({causa_averia_id:[this.bitacora.causa_averia?.id??null],consecuencia_averia_id:[this.bitacora.consecuencia_averia?.id??null],tipo_reparacion_id:[this.bitacora.tipo_reparacion?.id??null],herramientas:[this.bitacora.herramientas??null],tiempo_solucion:[this.bitacora.tiempo_solucion??null]}),this.configService.bitacorasFinalizar().subscribe(Z=>{this.causa=Z.causa,this.consecuencia=Z.consecuencia,this.tipoReparacion=Z.tipoReparacion})}guardar(){if(!this.bitacora.latitud||!this.bitacora.longitud)return void this.utilities.snackBar("La bitacora no puede ser cerrada, no cuenta con latitud y longitud");const r={...this.bitacora,...this.datosForm.value};this.bitacoraService.finalizar(r).subscribe(c=>{console.log(c),403==c.message?this.snackBar("Falta ingresar datos"):(this.snackBar("Registro Exitoso"),this.dialogRef.close(),this.router.navigate(["/bitacoras/list-bitacora"]))})}snackBar(r){this._snackBar.open(r,"Cerrar",{horizontalPosition:"right",verticalPosition:"top",duration:3e3})}static#t=this.\u0275fac=function(c){return new(c||_)(t.Y36(d.so),t.Y36(d.WI),t.Y36(C.TU),t.Y36(f.ux),t.Y36(m.k),t.Y36(b.E),t.Y36(i.F0),t.Y36(n.qu),t.Y36(o.e))};static#i=this.\u0275cmp=t.Xpm({type:_,selectors:[["app-end-bitacoras"]],decls:48,vars:5,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"row"],[1,"col-sm-12"],[1,"card"],[1,"card-body"],[1,"row",3,"formGroup"],[1,"col-12","col-md-6","col-xl-4"],[1,"form-group","local-forms"],[1,"login-danger"],["formControlName","causa_averia_id","placeholder","Seleccione Causa",1,"form-control","select"],[3,"value",4,"ngFor","ngForOf"],["formControlName","consecuencia_averia_id","placeholder","Seleccione Consecuencia",1,"form-control","select"],["formControlName","tipo_reparacion_id","placeholder","Seleccione Tipo Rep.",1,"form-control","select"],["for","tiempo_solucion"],["formControlName","tiempo_solucion","name","tiempo_solucion","type","text",1,"form-control"],["for","herramientas"],["name","herramientas","rows","5","cols","10","formControlName","herramientas",1,"form-control"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-button","","cdkFocusInitial","",3,"click"],[3,"value"]],template:function(c,p){1&c&&(t.TgZ(0,"h2",0),t._uU(1),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"form")(8,"div",6)(9,"div",7)(10,"div",8)(11,"mat-label"),t._uU(12,"Causa Averia "),t.TgZ(13,"span",9),t._uU(14,"*"),t.qZA()(),t.TgZ(15,"mat-select",10),t.YNc(16,T,2,2,"mat-option",11),t.qZA()()(),t.TgZ(17,"div",7)(18,"div",8)(19,"mat-label"),t._uU(20,"Consecuencia "),t.TgZ(21,"span",9),t._uU(22,"*"),t.qZA()(),t.TgZ(23,"mat-select",12),t.YNc(24,D,2,2,"mat-option",11),t.qZA()()(),t.TgZ(25,"div",7)(26,"div",8)(27,"mat-label"),t._uU(28,"Tipo de Reparaci\xf3n "),t.TgZ(29,"span",9),t._uU(30,"*"),t.qZA()(),t.TgZ(31,"mat-select",13),t.YNc(32,$,2,2,"mat-option",11),t.qZA()()(),t.TgZ(33,"div",7)(34,"div",8)(35,"mat-label",14),t._uU(36,"Tiempo atenci\xf3n "),t.qZA(),t._UZ(37,"input",15),t.qZA()(),t.TgZ(38,"div",7)(39,"div",8)(40,"mat-label",16),t._uU(41,"Material Utilizado "),t.qZA(),t._UZ(42,"textarea",17),t.qZA()()()()()()()()(),t.TgZ(43,"mat-dialog-actions",18)(44,"button",19),t._uU(45,"Cerrar"),t.qZA(),t.TgZ(46,"button",20),t.NdJ("click",function(){return p.guardar()}),t._uU(47,"Guardar"),t.qZA()()),2&c&&(t.xp6(1),t.hij("Finalizar Bitacora: ",p.bitacora.nombre,""),t.xp6(7),t.Q6J("formGroup",p.datosForm),t.xp6(8),t.Q6J("ngForOf",p.causa),t.xp6(8),t.Q6J("ngForOf",p.consecuencia),t.xp6(8),t.Q6J("ngForOf",p.tipoReparacion))},dependencies:[a.sg,e.hX,u.gD,h.ey,E.lW,d.ZT,d.uh,d.xY,d.H8,n._Y,n.Fj,n.JJ,n.JL,n.F,n.sg,n.u]})}return _})()},9909:(L,v,s)=>{s.d(v,{D:()=>$});var d=s(7700),t=s(5879),C=s(342),f=s(2939),m=s(2893),b=s(3059),i=s(9368),n=s(2122),o=s(9862),a=s(3586);let e=(()=>{class g extends i.p{constructor(l,r){super(l,r,"sites"),this.http=l,this.authService=r}showProvinciasDep(l){const r=this.getHeaders();return this.http.get(`${n.$g}/provinciasdep/${l}`,{headers:r})}showDistritoProv(l){const r=this.getHeaders();return this.http.get(`${n.$g}/distritoprov/${l}`,{headers:r})}createLocationBitacora(l){const r=this.getHeaders();return this.http.post(`${n.$g}/bitacoras/localizacion`,l,{headers:r})}static#t=this.\u0275fac=function(r){return new(r||g)(t.LFG(o.eN),t.LFG(a.e))};static#i=this.\u0275prov=t.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();var u=s(1303),h=s(6223),E=s(3432),T=s(9157),D=s(2296);let $=(()=>{class g{constructor(l,r,c,p,y,O,P,M,A,U){this.dialogRef=l,this.data=r,this.clipboard=c,this._snackBar=p,this.bitacoraService=y,this.configService=O,this.locationService=P,this.router=M,this.fb=A,this.utilities=U,this.bitacora=r.bitacora,this.datosForm=this.fb.group({latitud:[this.bitacora.latitud],longitud:[this.bitacora.longitud],distancia:[this.bitacora.distancia]},{validators:[this.utilities.validateCoordinates.bind(this.utilities)]})}guardar(){const l={...this.bitacora,...this.datosForm.value};console.log(l),this.locationService.createLocationBitacora(l).subscribe(r=>{403==r.message?this.utilities.snackBar("Falta ingresar datos"):(this.utilities.snackBar("Registro Exitoso"),this.dialogRef.close(),this.router.navigate(["/bitacoras/list-bitacora"]))})}getLocation(){this.bitacoraService.getPosition().then(l=>{this.bitacora.latitud=l.lat,this.bitacora.longitud=l.lng,this.datosForm.patchValue({latitud:this.bitacora.latitud,longitud:this.bitacora.longitud})})}static#t=this.\u0275fac=function(r){return new(r||g)(t.Y36(d.so),t.Y36(d.WI),t.Y36(C.TU),t.Y36(f.ux),t.Y36(m.k),t.Y36(b.E),t.Y36(e),t.Y36(u.F0),t.Y36(h.qu),t.Y36(E.e))};static#i=this.\u0275cmp=t.Xpm({type:g,selectors:[["app-location-bitacoras"]],decls:34,vars:5,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"row"],[1,"col-sm-12"],[1,"card"],[1,"card-body"],[1,"row",3,"formGroup"],[1,"col-12","col-md-6","col-xl-3"],[1,"form-group","local-forms"],["for","latitud"],["formControlName","latitud","name","latitud","type","text",1,"form-control"],["for","longitud"],["formControlName","longitud","name","longitud","type","text",1,"form-control"],[1,"col-12","col-md-6","col-xl-2"],["for","distancia"],["formControlName","distancia","name","distancia","type","number",1,"form-control"],[1,"btn","btn-primary","ms-1"],["aria-hidden","true",1,"fas","fa-map-marker-alt",3,"click"],["target","_blank",1,"btn","btn-primary","ms-1",3,"href"],["aria-hidden","true",1,"fa","fa-map",3,"click"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-button","","cdkFocusInitial","",3,"disabled","click"]],template:function(r,c){1&r&&(t.TgZ(0,"h2",0),t._uU(1),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"form")(8,"div",6)(9,"div",7)(10,"div",8)(11,"mat-label",9),t._uU(12," Latitud "),t.qZA(),t._UZ(13,"input",10),t.qZA()(),t.TgZ(14,"div",7)(15,"div",8)(16,"mat-label",11),t._uU(17," Longitud "),t.qZA(),t._UZ(18,"input",12),t.qZA()(),t.TgZ(19,"div",13)(20,"div",8)(21,"mat-label",14),t._uU(22,"Distancia "),t.qZA(),t._UZ(23,"input",15),t.qZA()(),t.TgZ(24,"div",7)(25,"button",16)(26,"i",17),t.NdJ("click",function(){return c.getLocation()}),t.qZA()(),t.TgZ(27,"a",18)(28,"i",19),t.NdJ("click",function(){return c.getLocation()}),t.qZA()()()()()()()()()(),t.TgZ(29,"mat-dialog-actions",20)(30,"button",21),t._uU(31,"Cerrar"),t.qZA(),t.TgZ(32,"button",22),t.NdJ("click",function(){return c.guardar()}),t._uU(33,"Guardar"),t.qZA()()),2&r&&(t.xp6(1),t.hij("Ubicaci\xf3n de: ",c.bitacora.nombre,""),t.xp6(7),t.Q6J("formGroup",c.datosForm),t.xp6(19),t.hYB("href","https://www.google.com/maps/search/?api=1&query=",c.bitacora.latitud,",",c.bitacora.longitud,"",t.LSH),t.xp6(5),t.Q6J("disabled",c.datosForm.invalid))},dependencies:[T.hX,D.lW,d.ZT,d.uh,d.xY,d.H8,h._Y,h.Fj,h.wV,h.JJ,h.JL,h.F,h.sg,h.u]})}return g})()},2893:(L,v,s)=>{s.d(v,{k:()=>b});var d=s(9862),t=s(2122),C=s(9368),f=s(5879),m=s(3586);let b=(()=>{class i extends C.p{constructor(o,a){super(o,a,"bitacoras"),this.http=o,this.authService=a,this.username="NMgkQskZIO0cGAZFM5H4791Ggx4sNMCo",this.password="u9yKXm0LE57UzztD",this.basicAuth=btoa(`${this.username}:${this.password}`),this.headersIder=new d.WM({"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${this.basicAuth}`}),this.body=JSON.stringify({grant_type:"client_credentials",scope:"https://api.latam.equifax.com/datos-comerciales/transaction"})}createAtencionBitacora(o){const a=this.getHeaders();return this.http.post(`${t.$g}/${this.endpoint}/atenciones`,o,{headers:a})}finalizar(o){const a=this.getHeaders();return this.http.post(`${t.$g}/${this.endpoint}/finalizar`,o,{headers:a})}demoras(o){const a=this.getHeaders();return this.http.post(`${t.$g}/${this.endpoint}/demoras`,o,{headers:a})}listAtencion(o){const a=this.getHeaders();return this.http.get(`${t.$g}/${this.endpoint}/atencion/${o}`,{headers:a})}listDemoras(o){const a=this.getHeaders();return this.http.get(`${t.$g}/${this.endpoint}/demoras/${o}`,{headers:a})}getPosition(){return new Promise((o,a)=>{navigator.geolocation.getCurrentPosition(e=>{o({lng:e.coords.longitude,lat:e.coords.latitude})},e=>{a(e)})})}exportExcel(){const o=this.getHeaders();return this.http.get(`${t.$g}/${this.endpoint}/exportaBitacoras`,{headers:o})}closedSot(o){const a=this.getHeaders();return this.http.patch(`${t.$g}/${this.endpoint}/closed-sot/${o}`,{},{headers:a})}static#t=this.\u0275fac=function(a){return new(a||i)(f.LFG(d.eN),f.LFG(m.e))};static#i=this.\u0275prov=f.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})()},3432:(L,v,s)=>{s.d(v,{e:()=>f});var d=s(5879),t=s(6814),C=s(2939);let f=(()=>{class m{constructor(i,n){this.datePipe=i,this._snackBar=n,this.PERU_BOUNDS={minLat:-18,maxLat:-.1,minLong:-81.4,maxLong:-68.5}}armaBitacora(i){let a,n=this.brigadas(i.brigadas),o=this.atenciones(i.atenciones),e="";return"0"===i.estado&&(e=`\n*Causa:* ${i.causa_averia.nombre}; \n*Consecuencia:* ${i.consecuencia_averia.nombre}; \n*Tipo de Reparaci\xf3n:* ${i.tipo_reparacion.nombre}; \n*Tiempo de soluci\xf3n:* ${i.tiempo_solucion||""}; \n*Material Utilizado:* \n${i.herramientas||"- Sin materiales"}\n`),a=`#*${i.nombre} - ${i.enlace_plano_site}* \n_FechaInicial:_ ${i.fecha_inicial||""} \n_NroSot:_ ${i.sot||""} \n_NroIncidencia:_ ${i.incidencia||""} \n_TipoAveria:_ ${i.tipo_averia.nombre||""} \n_TipoSitePop:_ ${i.site.tipo_site?.nombre||""} \n_NombreSite:_ *${i.site.nombre||""}* \n_NombreCliente:_ *${i.cliente||""}* \n_Lat:_ ${i.latitud||""}, _Lon:_ ${i.longitud||""} \n_Distancia:_ ${i.distancia||""} Kms \n_Region:_ ${i.site.region||""} \n_Departamento:_ ${i.site.departamento?.nombre||""} \n_Distrito:_ ${i.site.distrito?.nombre||""} \n_red1:_ ${i.red.nombre||""} , ${n}\n_Responsable Cicsa:_ ${i.resp_cicsa.nombres||""} -T: ${i.resp_cicsa.telefono||""} \n_Responsable Claro:_ ${i.resp_claro.nombres||""} -T: ${i.resp_claro.telefono||""} \n${e}\n${o} `,a}atenciones(i){var n="";return i.forEach(o=>{o.bitacora_atencion.forEach(e=>{const u=this.datePipe.transform(e.hora,"HH:mm");n+="0"==e.is_coment?` *${u} * ${e.descripcion} \n`:`   *-* ${e.descripcion} \n`});const a=this.datePipe.transform(o.hora,"HH:mm");n+=` *${a} (${o.atencion.orden}) ${o.atencion.descripcion}*, ${o.descripcion} \n`}),n}brigadas(i){let n="",o=1;return i.forEach(a=>{a.user_movil.forEach(e=>{"1"===e.is_lider&&(n+=`\n_Bri${o}:_ ${a.zona.nombre}: ${e.user.nombre} - Placa: ${e.unidad_movil?.placa||""} Cel: ${e.user.celular||""}`,o++)})}),n}obtenerCuadrante(i){const[n,o]=i.split(":").map(Number),a=60*n+o;return a>=420&&a<=779?"Ma\xf1ana":a>=780&&a<=1139?"Tarde":a>=1140&&a<=1439?"Noche":"Madrugada"}TotalDemoras(i){let n=0;for(let e=0;e<i.length;e++){const u=i[e];n+=new Date(u.fecha_fin).valueOf()-new Date(u.fecha_inicio).valueOf()}const o=Math.floor(n/1e3/60/60),a=n/1e3/60-60*o;return o.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0")}isValidCoordinate(i){return!isNaN(i)&&null!==i}validateLatLong(i,n){return i>=-18&&i<=-.1&&n>=-81&&n<=-68}validateCoordinates(i){const n=i.get("latitud")?.value,o=i.get("longitud")?.value;return null!==n&&""!==n||null!==o&&""!==o?n&&(null===o||""===o)||o&&(null===n||""===n)?{missingCoordinate:!0}:n&&!this.isValidCoordinate(n)?{invalidLatitude:!0}:o&&!this.isValidCoordinate(o)?{invalidLongitude:!0}:n&&o&&!this.validateLatLong(n,o)?{outOfPeru:!0}:null:null}snackBar(i){this._snackBar.open(i,"Cerrar",{horizontalPosition:"right",verticalPosition:"top",duration:3e3})}isMobile(){const i=navigator.userAgent.toLowerCase();return["android","iphone","ipad","ipod","blackberry","windows phone","opera mini","mobile"].some(o=>i.includes(o))}static#t=this.\u0275fac=function(n){return new(n||m)(d.LFG(t.uU),d.LFG(C.ux))};static#i=this.\u0275prov=d.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})}return m})()},342:(L,v,s)=>{s.d(v,{TU:()=>f});var d=s(6814),t=s(5879);class C{constructor(o,a){this._document=a;const e=this._textarea=this._document.createElement("textarea"),u=e.style;u.position="fixed",u.top=u.opacity="0",u.left="-999em",e.setAttribute("aria-hidden","true"),e.value=o,e.readOnly=!0,(this._document.fullscreenElement||this._document.body).appendChild(e)}copy(){const o=this._textarea;let a=!1;try{if(o){const e=this._document.activeElement;o.select(),o.setSelectionRange(0,o.value.length),a=this._document.execCommand("copy"),e&&e.focus()}}catch{}return a}destroy(){const o=this._textarea;o&&(o.remove(),this._textarea=void 0)}}let f=(()=>{class n{constructor(a){this._document=a}copy(a){const e=this.beginCopy(a),u=e.copy();return e.destroy(),u}beginCopy(a){return new C(a,this._document)}static#t=this.\u0275fac=function(e){return new(e||n)(t.LFG(d.K0))};static#i=this.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})()}}]);